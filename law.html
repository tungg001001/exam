<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>è³‡è¨Šå€«ç†èˆ‡æ³•å¾‹æ¸¬é©—</title>
<style>
body{font-family:"Microsoft JhengHei",sans-serif;background:#0f172a;color:#e5e7eb;padding:20px;}
h1,h2,h3{color:#38bdf8;}
.section{background:#020617;padding:15px;border-radius:8px;margin-bottom:20px;}
.question{margin-bottom:15px;}
input{padding:5px;margin:5px;}
button{background:#38bdf8;border:none;padding:10px 20px;font-size:16px;border-radius:6px;cursor:pointer;margin:5px;}
button:hover{background:#0ea5e9;}
button.danger{background:#ef4444;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #334155;padding:8px;text-align:center;}
th{background:#1e293b;}
</style>
</head>
<body>

<h1>âš–ï¸ è³‡è¨Šå€«ç†èˆ‡æ³•å¾‹æ¸¬é©—ï¼ˆ20 é¡Œï¼‰</h1>

<div class="section">
  <h2>ğŸ‘¨â€ğŸ“ å­¸ç”Ÿè³‡æ–™</h2>
  ç­ç´šï¼š<input id="className">
  åº§è™Ÿï¼š<input id="no">
  å§“åï¼š<input id="name">
</div>

<div class="section" id="quiz"></div>
<button onclick="submitQuiz()">æäº¤æ¸¬é©—</button>
<h2 id="result"></h2>

<hr>

<div class="section" id="teacherLoginDiv">
  <h2>ğŸ” æ•™å¸«ç™»å…¥</h2>
  æ•™å¸«å¯†ç¢¼ï¼š<input type="password" id="teacherPwd">
  <button onclick="teacherLogin()">ç™»å…¥</button>
  <p id="loginMsg" style="color:#f87171"></p>
</div>

<div class="section" id="teacherArea" style="display:none">
  <h2>ğŸ‘¨â€ğŸ« æ•™å¸«æˆç¸¾ç¸½è¦½</h2>
  <button onclick="exportCSV()">ğŸ“¤ åŒ¯å‡º CSV</button>
  <button class="danger" onclick="clearRecords()">ğŸ—‘ æ¸…ç©ºæ‰€æœ‰æˆç¸¾</button>

  <table>
    <thead>
      <tr>
        <th>ç­ç´š</th><th>åº§è™Ÿ</th><th>å§“å</th><th>åˆ†æ•¸</th><th>æ™‚é–“</th>
      </tr>
    </thead>
    <tbody id="records"></tbody>
  </table>

  <button onclick="showAnswers()">ğŸ“¢ å…¬ä½ˆæ­£ç¢ºç­”æ¡ˆ</button>
  <div id="answerDiv" style="display:none">
    <h3>ğŸ“Œ æ­£ç¢ºç­”æ¡ˆè¡¨</h3>
    <table>
      <thead>
        <tr><th>é¡Œè™Ÿ</th><th>é¡Œç›®</th><th>æ­£ç¢ºç­”æ¡ˆ</th></tr>
      </thead>
      <tbody id="answerKey"></tbody>
    </table>
  </div>
</div>

<script>
const TEACHER_PASSWORD = "teacher123";

/* ===== é¡Œåº«ï¼šè³‡è¨Šå€«ç†èˆ‡æ³•å¾‹ï¼ˆ20 é¡Œï¼‰===== */
const questions = [
 {id:1,q:"ä¸‹è¼‰ç›œç‰ˆè»Ÿé«”çš„æ³•å¾‹è²¬ä»»ï¼Ÿ",o:["åˆæ³•","ç„¡è²¬ä»»","ä¾µå®³è‘—ä½œæ¬Š","é¼“å‹µå‰µä½œ"],a:2},
 {id:2,q:"ä»¥ä¸‹ä½•è€…å±¬æ–¼å€‹äººè³‡æ–™ï¼Ÿ",o:["å­¸æ ¡åç¨±","å¤©æ°£","èº«åˆ†è­‰å­—è™Ÿ","åœ‹å®šå‡æ—¥"],a:2},
 {id:3,q:"æœªç¶“åŒæ„å…¬é–‹ä»–äººç…§ç‰‡ï¼Œå¯èƒ½ï¼Ÿ",o:["æ²’å•é¡Œ","ä¾µçŠ¯éš±ç§","å€¼å¾—é¼“å‹µ","åˆæ³•"],a:1},
 {id:4,q:"è‘—ä½œæ¬Šä¿è­·çš„æ˜¯ï¼Ÿ",o:["æƒ³æ³•","å‰µæ„æœ¬èº«","å…·é«”è¡¨é”","è¨­å‚™"],a:2},
 {id:5,q:"ä»¥ä¸‹ä½•è€…æ˜¯åˆæ³•ä½¿ç”¨è»Ÿé«”ï¼Ÿ",o:["ç ´è§£","å…±äº«åºè™Ÿ","è³¼è²·æˆæ¬Š","ç›œæ‹·"],a:2},
 {id:6,q:"æ•£å¸ƒå‡è¨Šæ¯å¯èƒ½é€ æˆï¼Ÿ",o:["ç¤¾æœƒæ··äº‚","æå‡ä¿¡ä»»","åˆæ³•","ç„¡å½±éŸ¿"],a:0},
 {id:7,q:"åœ¨ç¶²è·¯ä¸Šè¾±ç½µä»–äººï¼Œå¯èƒ½æ¶‰åŠï¼Ÿ",o:["è‘—ä½œæ¬Š","èª¹è¬—","å°ˆåˆ©","åˆæ³•è¡Œç‚º"],a:1},
 {id:8,q:"å°Šé‡ä»–äººéš±ç§çš„æ­£ç¢ºè¡Œç‚ºï¼Ÿ",o:["è½‰å‚³èŠå¤©ç´€éŒ„","å·æ‹","æœªç¶“åŒæ„ä¸å…¬é–‹","å…¬é–‹å€‹è³‡"],a:2},
 {id:9,q:"ä¸‹åˆ—ä½•è€…å±¬æ–¼è³‡è¨Šå€«ç†ï¼Ÿ",o:["å°Šé‡æ™ºæ…§è²¡ç”¢","å¤§é‡ç›œç‰ˆ","æ•£å¸ƒè¬ è¨€","é§­å…¥å¸³è™Ÿ"],a:0},
 {id:10,q:"åˆæ³•å¼•ç”¨ä»–äººä½œå“éœ€ï¼Ÿ",o:["ä¸æ¨™ç¤ºä¾†æº","ä»»æ„ä¿®æ”¹","æ¨™ç¤ºå‡ºè™•","ç•¶æˆè‡ªå·±"],a:2},
 {id:11,q:"ä»¥ä¸‹ä½•è€…å¯èƒ½é•åå€‹è³‡æ³•ï¼Ÿ",o:["ä¿è­·è³‡æ–™","åŠ å¯†","å¤–æ´©åå–®","è¨­å®šå¯†ç¢¼"],a:2},
 {id:12,q:"æœªç¶“å…è¨±ä½¿ç”¨ä»–äººå¸³è™Ÿå±¬æ–¼ï¼Ÿ",o:["æ­£å¸¸è¡Œç‚º","æœªæˆæ¬Šå­˜å–","åˆ†äº«","å€«ç†è¡Œç‚º"],a:1},
 {id:13,q:"ç¶²è·¯åŒ¿åæ˜¯å¦ä»£è¡¨ä¸ç”¨è² è²¬ï¼Ÿ",o:["æ˜¯","å¦","é¼“å‹µ","åˆæ³•"],a:1},
 {id:14,q:"æ™ºæ…§è²¡ç”¢æ¬Šä¸åŒ…å«ï¼Ÿ",o:["è‘—ä½œæ¬Š","å°ˆåˆ©æ¬Š","å•†æ¨™æ¬Š","äººèº«è‡ªç”±"],a:3},
 {id:15,q:"å­¸ç”Ÿäº¤å ±å‘Šå¼•ç”¨è³‡æ–™æ‡‰ï¼Ÿ",o:["ç…§æŠ„","ä¸æ¨™ä¾†æº","æ¨™è¨»å‡ºè™•","åˆªä½œè€…"],a:2},
 {id:16,q:"ä»¥ä¸‹ä½•è€…å±¬æ–¼ç¶²è·¯éœ¸å‡Œï¼Ÿ",o:["ç†æ€§è¨è«–","æƒ¡æ„æ”»æ“Š","å»ºè­°","åˆ†äº«çŸ¥è­˜"],a:1},
 {id:17,q:"åˆæ³•ä¸‹è¼‰éŸ³æ¨‚æ–¹å¼ï¼Ÿ",o:["éæ³•ç¶²ç«™","è³¼è²·æ­£ç‰ˆ","ç ´è§£","åˆ†äº«å¸³è™Ÿ"],a:1},
 {id:18,q:"å€‹è³‡è’é›†æ‡‰éµå®ˆï¼Ÿ",o:["æœ€å°å¿…è¦åŸå‰‡","è¶Šå¤šè¶Šå¥½","å…¬é–‹é€æ˜","ä¸ç”¨å‘ŠçŸ¥"],a:0},
 {id:19,q:"æ•£å¸ƒç—…æ¯’ç¨‹å¼å¯èƒ½è§¸çŠ¯ï¼Ÿ",o:["äº¤é€šæ³•","åˆ‘æ³•","ç’°ä¿æ³•","ç„¡è²¬ä»»"],a:1},
 {id:20,q:"è³‡è¨Šå€«ç†æ•™è‚²ç›®çš„ï¼Ÿ",o:["é™åˆ¶ä½¿ç”¨","æå‡è²¬ä»»æ„Ÿ","ç¦æ­¢ç¶²è·¯","ä¸å­¸ç§‘æŠ€"],a:1}
];

let currentQuestions = [];

/* ===== è¼‰å…¥é¡Œç›®ï¼ˆéš¨æ©Ÿï¼‰===== */
window.onload = function(){
  currentQuestions = [...questions].sort(()=>Math.random()-0.5);
  const quiz = document.getElementById("quiz");
  quiz.innerHTML="";
  currentQuestions.forEach((q,i)=>{
    let html = `<div class="question"><b>${i+1}. ${q.q}</b><br>`;
    q.o.forEach((o,j)=>{
      html+=`<label><input type="radio" name="q${i}" value="${j}"> ${o}</label><br>`;
    });
    html+="</div>";
    quiz.innerHTML+=html;
  });
}

/* ===== å­¸ç”Ÿæäº¤ ===== */
function submitQuiz(){
  const c=className.value,n=no.value,nm=name.value;
  if(!c||!n||!nm){alert("è«‹å¡«å®Œæ•´å­¸ç”Ÿè³‡æ–™");return;}

  let score=0;
  currentQuestions.forEach((q,i)=>{
    const s=document.querySelector(`input[name="q${i}"]:checked`);
    if(s && +s.value===q.a) score++;
  });

  result.innerText=`ä½ çš„æˆç¸¾ï¼š${score} / 20`;

  const data=JSON.parse(localStorage.getItem("records")||"[]");
  data.push({class:c,no:n,name:nm,score,time:new Date().toLocaleString()});
  localStorage.setItem("records",JSON.stringify(data));
  loadRecords();
}

/* ===== æ•™å¸«ç™»å…¥ ===== */
function teacherLogin(){
  if(teacherPwd.value===TEACHER_PASSWORD){
    teacherLoginDiv.style.display="none";
    teacherArea.style.display="block";
    loadRecords();
  }else loginMsg.innerText="âŒ å¯†ç¢¼éŒ¯èª¤";
}

/* ===== é¡¯ç¤ºæˆç¸¾ ===== */
function loadRecords(){
  records.innerHTML="";
  const data=JSON.parse(localStorage.getItem("records")||"[]");
  data.forEach(r=>{
    records.innerHTML+=`<tr>
      <td>${r.class}</td><td>${r.no}</td><td>${r.name}</td>
      <td>${r.score}</td><td>${r.time}</td></tr>`;
  });
}

/* ===== æ¸…ç©ºæˆç¸¾ ===== */
function clearRecords(){
  if(confirm("ç¢ºå®šæ¸…ç©ºæ‰€æœ‰å­¸ç”Ÿæˆç¸¾ï¼Ÿ")){
    localStorage.removeItem("records");
    loadRecords();
    alert("âœ… æˆç¸¾å·²æ¸…ç©º");
  }
}

/* ===== å…¬ä½ˆç­”æ¡ˆ ===== */
function showAnswers(){
  answerDiv.style.display="block";
  answerKey.innerHTML="";
  questions.forEach(q=>{
    answerKey.innerHTML+=`<tr>
      <td>${q.id}</td><td>${q.q}</td><td>${q.o[q.a]}</td></tr>`;
  });
}

/* ===== CSV åŒ¯å‡ºï¼ˆUTF-8 + BOMï¼‰===== */
function exportCSV(){
  const data=JSON.parse(localStorage.getItem("records")||"[]");
  if(!data.length){alert("æ²’æœ‰æˆç¸¾");return;}

  let csv="ç­ç´š,åº§è™Ÿ,å§“å,åˆ†æ•¸,æ™‚é–“\n";
  data.forEach(r=>{
    csv+=`"${r.class}","${r.no}","${r.name}","${r.score}","${r.time}"\n`;
  });

  const BOM="\uFEFF";
  const blob=new Blob([BOM+csv],{type:"text/csv;charset=utf-8;"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="è³‡è¨Šå€«ç†èˆ‡æ³•å¾‹æ¸¬é©—æˆç¸¾.csv";
  a.click();
}
</script>

</body>
</html>
