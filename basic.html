const TEACHER_PASSWORD = "teacher123"; // 教師密碼，可自訂

// 學生提交後呼叫
function submitQuiz(){
  const c = document.getElementById("className").value;
  const n = document.getElementById("no").value;
  const nm = document.getElementById("name").value;
  if(!c||!n||!nm){alert("請填完整學生資料");return;}

  let score = 0;
  questions.forEach((q,i)=>{
    const s = document.querySelector(`input[name="q${i}"]:checked`);
    if(s && +s.value===q.a) score++;
  });
  document.getElementById("result").innerText = `你的成績：${score} / 20`;

  // 存到 localStorage
  const data = JSON.parse(localStorage.getItem("records")||"[]");
  data.push({
    class: c,
    no: n,
    name: nm,
    score: score,
    time: new Date().toLocaleString()
  });
  localStorage.setItem("records", JSON.stringify(data));

  loadRecords(); // 更新教師區
}

// 教師登入
function teacherLogin(){
  const pwd = document.getElementById("teacherPwd").value;
  if(pwd===TEACHER_PASSWORD){
    document.getElementById("teacherLoginDiv").style.display="none";
    document.getElementById("teacherArea").style.display="block";
    loadRecords();
  } else {
    document.getElementById("loginMsg").innerText="❌ 密碼錯誤";
  }
}

// 載入成績
function loadRecords(){
  const tbody = document.getElementById("records");
  tbody.innerHTML = "";
  const data = JSON.parse(localStorage.getItem("records")||"[]");
  data.forEach(r=>{
    tbody.innerHTML += `<tr>
      <td>${r.class}</td>
      <td>${r.no}</td>
      <td>${r.name}</td>
      <td>${r.score}</td>
      <td>${r.time}</td>
    </tr>`;
  });
}

// CSV 匯出
function exportCSV(){
  const data = JSON.parse(localStorage.getItem("records")||"[]");
  let csv="班級,座號,姓名,分數,時間\n";
  data.forEach(r=>{
    csv+=`${r.class},${r.no},${r.name},${r.score},${r.time}\n`;
  });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(new Blob([csv], {type:"text/csv"}));
  a.download = "資通安全測驗成績.csv";
  a.click();
}
